services:
  categories:
    build: ./categories
    container_name: categories
    image: neniel/tennis-categories:latest
    ports:
      - 8080:8080
    environment:
      - APP_PORT=:8080
      - APP_ENVIRONMENT=docker
      - MONGODB_URI_FILE=/run/secrets/mongodb_uri
      - REDIS_ADDRESS_FILE=/run/secrets/redis_address
      - REDIS_PASSWORD_FILE=/run/secrets/redis_password
      - GRAFANA_GRAPHITE_TOKEN=/run/secrets/grafana_graphite_token
    secrets:
      - mongodb_uri
      - redis_address
      - redis_password
      - grafana_graphite_token

  players:
    build: ./players
    container_name: players
    image: neniel/tennis-players:latest
    ports:
      - 8081:8080
    environment:
      - APP_PORT=:8080
      - APP_ENVIRONMENT=docker
      - MONGODB_URI_FILE=/run/secrets/mongodb_uri
      - REDIS_ADDRESS_FILE=/run/secrets/redis_address
      - REDIS_PASSWORD_FILE=/run/secrets/redis_password
      - GRAFANA_GRAPHITE_TOKEN=/run/secrets/grafana_graphite_token
    secrets:
      - mongodb_uri
      - redis_address
      - redis_password
      - grafana_graphite_token

  cache:
    build: ./cache
    container_name: cache
    image: neniel/tennis-cache:latest
    environment:
      - APP_ENVIRONMENT=docker
      - MONGODB_URI_FILE=/run/secrets/mongodb_uri
      - REDIS_ADDRESS_FILE=/run/secrets/redis_address
      - REDIS_PASSWORD_FILE=/run/secrets/redis_password
      - GRAFANA_GRAPHITE_TOKEN=/run/secrets/grafana_graphite_token
    secrets:
      - mongodb_uri
      - redis_address
      - redis_password
      - grafana_graphite_token

  redis:
    image: redis:latest
    container_name: redis
    ports:
      - "6379:6379"
